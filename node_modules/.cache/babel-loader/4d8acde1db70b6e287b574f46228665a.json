{"ast":null,"code":"/*\n Copyright 2011-2013 Abdulla Abdurakhmanov\n Original sources are available at https://code.google.com/p/x2js/\n\n Licensed under the Apache License, Version 2.0 (the \"License\");\n you may not use this file except in compliance with the License.\n You may obtain a copy of the License at\n\n http://www.apache.org/licenses/LICENSE-2.0\n\n Unless required by applicable law or agreed to in writing, software\n distributed under the License is distributed on an \"AS IS\" BASIS,\n WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n See the License for the specific language governing permissions and\n limitations under the License.\n */\n(function (root, factory) {\n  if (typeof define === \"function\" && define.amd) {\n    define([], factory);\n  } else if (typeof exports === \"object\") {\n    module.exports = factory();\n  } else {\n    root.X2JS = factory();\n  }\n})(this, function () {\n  return function (config) {\n    'use strict';\n\n    var VERSION = \"1.2.0\";\n    config = config || {};\n    initConfigDefaults();\n    initRequiredPolyfills();\n\n    function initConfigDefaults() {\n      if (config.escapeMode === undefined) {\n        config.escapeMode = true;\n      }\n\n      config.attributePrefix = config.attributePrefix || \"_\";\n      config.arrayAccessForm = config.arrayAccessForm || \"none\";\n      config.emptyNodeForm = config.emptyNodeForm || \"text\";\n\n      if (config.enableToStringFunc === undefined) {\n        config.enableToStringFunc = true;\n      }\n\n      config.arrayAccessFormPaths = config.arrayAccessFormPaths || [];\n\n      if (config.skipEmptyTextNodesForObj === undefined) {\n        config.skipEmptyTextNodesForObj = true;\n      }\n\n      if (config.stripWhitespaces === undefined) {\n        config.stripWhitespaces = true;\n      }\n\n      config.datetimeAccessFormPaths = config.datetimeAccessFormPaths || [];\n\n      if (config.useDoubleQuotes === undefined) {\n        config.useDoubleQuotes = false;\n      }\n\n      config.xmlElementsFilter = config.xmlElementsFilter || [];\n      config.jsonPropertiesFilter = config.jsonPropertiesFilter || [];\n\n      if (config.keepCData === undefined) {\n        config.keepCData = false;\n      }\n    }\n\n    var DOMNodeTypes = {\n      ELEMENT_NODE: 1,\n      TEXT_NODE: 3,\n      CDATA_SECTION_NODE: 4,\n      COMMENT_NODE: 8,\n      DOCUMENT_NODE: 9\n    };\n\n    function initRequiredPolyfills() {}\n\n    function getNodeLocalName(node) {\n      var nodeLocalName = node.localName;\n      if (nodeLocalName == null) // Yeah, this is IE!! \n        nodeLocalName = node.baseName;\n      if (nodeLocalName == null || nodeLocalName == \"\") // ==\"\" is IE too\n        nodeLocalName = node.nodeName;\n      return nodeLocalName;\n    }\n\n    function getNodePrefix(node) {\n      return node.prefix;\n    }\n\n    function escapeXmlChars(str) {\n      if (typeof str == \"string\") return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;').replace(/'/g, '&apos;');else return str;\n    }\n\n    function unescapeXmlChars(str) {\n      return str.replace(/&lt;/g, '<').replace(/&gt;/g, '>').replace(/&quot;/g, '\"').replace(/&apos;/g, \"'\").replace(/&amp;/g, '&');\n    }\n\n    function checkInStdFiltersArrayForm(stdFiltersArrayForm, obj, name, path) {\n      var idx = 0;\n\n      for (; idx < stdFiltersArrayForm.length; idx++) {\n        var filterPath = stdFiltersArrayForm[idx];\n\n        if (typeof filterPath === \"string\") {\n          if (filterPath == path) break;\n        } else if (filterPath instanceof RegExp) {\n          if (filterPath.test(path)) break;\n        } else if (typeof filterPath === \"function\") {\n          if (filterPath(obj, name, path)) break;\n        }\n      }\n\n      return idx != stdFiltersArrayForm.length;\n    }\n\n    function toArrayAccessForm(obj, childName, path) {\n      switch (config.arrayAccessForm) {\n        case \"property\":\n          if (!(obj[childName] instanceof Array)) obj[childName + \"_asArray\"] = [obj[childName]];else obj[childName + \"_asArray\"] = obj[childName];\n          break;\n\n        /*case \"none\":\n            break;*/\n      }\n\n      if (!(obj[childName] instanceof Array) && config.arrayAccessFormPaths.length > 0) {\n        if (checkInStdFiltersArrayForm(config.arrayAccessFormPaths, obj, childName, path)) {\n          obj[childName] = [obj[childName]];\n        }\n      }\n    }\n\n    function fromXmlDateTime(prop) {\n      // Implementation based up on http://stackoverflow.com/questions/8178598/xml-datetime-to-javascript-date-object\n      // Improved to support full spec and optional parts\n      var bits = prop.split(/[-T:+Z]/g);\n      var d = new Date(bits[0], bits[1] - 1, bits[2]);\n      var secondBits = bits[5].split(\"\\.\");\n      d.setHours(bits[3], bits[4], secondBits[0]);\n      if (secondBits.length > 1) d.setMilliseconds(secondBits[1]); // Get supplied time zone offset in minutes\n\n      if (bits[6] && bits[7]) {\n        var offsetMinutes = bits[6] * 60 + Number(bits[7]);\n        var sign = /\\d\\d-\\d\\d:\\d\\d$/.test(prop) ? '-' : '+'; // Apply the sign\n\n        offsetMinutes = 0 + (sign == '-' ? -1 * offsetMinutes : offsetMinutes); // Apply offset and local timezone\n\n        d.setMinutes(d.getMinutes() - offsetMinutes - d.getTimezoneOffset());\n      } else if (prop.indexOf(\"Z\", prop.length - 1) !== -1) {\n        d = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate(), d.getHours(), d.getMinutes(), d.getSeconds(), d.getMilliseconds()));\n      } // d is now a local time equivalent to the supplied time\n\n\n      return d;\n    }\n\n    function checkFromXmlDateTimePaths(value, childName, fullPath) {\n      if (config.datetimeAccessFormPaths.length > 0) {\n        var path = fullPath.split(\"\\.#\")[0];\n\n        if (checkInStdFiltersArrayForm(config.datetimeAccessFormPaths, value, childName, path)) {\n          return fromXmlDateTime(value);\n        } else return value;\n      } else return value;\n    }\n\n    function checkXmlElementsFilter(obj, childType, childName, childPath) {\n      if (childType == DOMNodeTypes.ELEMENT_NODE && config.xmlElementsFilter.length > 0) {\n        return checkInStdFiltersArrayForm(config.xmlElementsFilter, obj, childName, childPath);\n      } else return true;\n    }\n\n    function parseDOMChildren(node, path) {\n      if (node.nodeType == DOMNodeTypes.DOCUMENT_NODE) {\n        var result = new Object();\n        var nodeChildren = node.childNodes; // Alternative for firstElementChild which is not supported in some environments\n\n        for (var cidx = 0; cidx < nodeChildren.length; cidx++) {\n          var child = nodeChildren.item(cidx);\n\n          if (child.nodeType == DOMNodeTypes.ELEMENT_NODE) {\n            var childName = getNodeLocalName(child);\n            result[childName] = parseDOMChildren(child, childName);\n          }\n        }\n\n        return result;\n      } else if (node.nodeType == DOMNodeTypes.ELEMENT_NODE) {\n        var result = new Object();\n        result.__cnt = 0;\n        var nodeChildren = node.childNodes; // Children nodes\n\n        for (var cidx = 0; cidx < nodeChildren.length; cidx++) {\n          var child = nodeChildren.item(cidx); // nodeChildren[cidx];\n\n          var childName = getNodeLocalName(child);\n\n          if (child.nodeType != DOMNodeTypes.COMMENT_NODE) {\n            var childPath = path + \".\" + childName;\n\n            if (checkXmlElementsFilter(result, child.nodeType, childName, childPath)) {\n              result.__cnt++;\n\n              if (result[childName] == null) {\n                result[childName] = parseDOMChildren(child, childPath);\n                toArrayAccessForm(result, childName, childPath);\n              } else {\n                if (result[childName] != null) {\n                  if (!(result[childName] instanceof Array)) {\n                    result[childName] = [result[childName]];\n                    toArrayAccessForm(result, childName, childPath);\n                  }\n                }\n\n                result[childName][result[childName].length] = parseDOMChildren(child, childPath);\n              }\n            }\n          }\n        } // Attributes\n\n\n        for (var aidx = 0; aidx < node.attributes.length; aidx++) {\n          var attr = node.attributes.item(aidx); // [aidx];\n\n          result.__cnt++;\n          result[config.attributePrefix + attr.name] = attr.value;\n        } // Node namespace prefix\n\n\n        var nodePrefix = getNodePrefix(node);\n\n        if (nodePrefix != null && nodePrefix != \"\") {\n          result.__cnt++;\n          result.__prefix = nodePrefix;\n        }\n\n        if (result[\"#text\"] != null) {\n          result.__text = result[\"#text\"];\n\n          if (result.__text instanceof Array) {\n            result.__text = result.__text.join(\"\\n\");\n          } //if(config.escapeMode)\n          //\tresult.__text = unescapeXmlChars(result.__text);\n\n\n          if (config.stripWhitespaces) result.__text = result.__text.trim();\n          delete result[\"#text\"];\n          if (config.arrayAccessForm == \"property\") delete result[\"#text_asArray\"];\n          result.__text = checkFromXmlDateTimePaths(result.__text, childName, path + \".\" + childName);\n        }\n\n        if (result[\"#cdata-section\"] != null) {\n          result.__cdata = result[\"#cdata-section\"];\n          delete result[\"#cdata-section\"];\n          if (config.arrayAccessForm == \"property\") delete result[\"#cdata-section_asArray\"];\n        }\n\n        if (result.__cnt == 0 && config.emptyNodeForm == \"text\") {\n          result = '';\n        } else if (result.__cnt == 1 && result.__text != null) {\n          result = result.__text;\n        } else if (result.__cnt == 1 && result.__cdata != null && !config.keepCData) {\n          result = result.__cdata;\n        } else if (result.__cnt > 1 && result.__text != null && config.skipEmptyTextNodesForObj) {\n          if (config.stripWhitespaces && result.__text == \"\" || result.__text.trim() == \"\") {\n            delete result.__text;\n          }\n        }\n\n        delete result.__cnt;\n\n        if (config.enableToStringFunc && (result.__text != null || result.__cdata != null)) {\n          result.toString = function () {\n            return (this.__text != null ? this.__text : '') + (this.__cdata != null ? this.__cdata : '');\n          };\n        }\n\n        return result;\n      } else if (node.nodeType == DOMNodeTypes.TEXT_NODE || node.nodeType == DOMNodeTypes.CDATA_SECTION_NODE) {\n        return node.nodeValue;\n      }\n    }\n\n    function startTag(jsonObj, element, attrList, closed) {\n      var resultStr = \"<\" + (jsonObj != null && jsonObj.__prefix != null ? jsonObj.__prefix + \":\" : \"\") + element;\n\n      if (attrList != null) {\n        for (var aidx = 0; aidx < attrList.length; aidx++) {\n          var attrName = attrList[aidx];\n          var attrVal = jsonObj[attrName];\n          if (config.escapeMode) attrVal = escapeXmlChars(attrVal);\n          resultStr += \" \" + attrName.substr(config.attributePrefix.length) + \"=\";\n          if (config.useDoubleQuotes) resultStr += '\"' + attrVal + '\"';else resultStr += \"'\" + attrVal + \"'\";\n        }\n      }\n\n      if (!closed) resultStr += \">\";else resultStr += \"/>\";\n      return resultStr;\n    }\n\n    function endTag(jsonObj, elementName) {\n      return \"</\" + (jsonObj.__prefix != null ? jsonObj.__prefix + \":\" : \"\") + elementName + \">\";\n    }\n\n    function endsWith(str, suffix) {\n      return str.indexOf(suffix, str.length - suffix.length) !== -1;\n    }\n\n    function jsonXmlSpecialElem(jsonObj, jsonObjField) {\n      if (config.arrayAccessForm == \"property\" && endsWith(jsonObjField.toString(), \"_asArray\") || jsonObjField.toString().indexOf(config.attributePrefix) == 0 || jsonObjField.toString().indexOf(\"__\") == 0 || jsonObj[jsonObjField] instanceof Function) return true;else return false;\n    }\n\n    function jsonXmlElemCount(jsonObj) {\n      var elementsCnt = 0;\n\n      if (jsonObj instanceof Object) {\n        for (var it in jsonObj) {\n          if (jsonXmlSpecialElem(jsonObj, it)) continue;\n          elementsCnt++;\n        }\n      }\n\n      return elementsCnt;\n    }\n\n    function checkJsonObjPropertiesFilter(jsonObj, propertyName, jsonObjPath) {\n      return config.jsonPropertiesFilter.length == 0 || jsonObjPath == \"\" || checkInStdFiltersArrayForm(config.jsonPropertiesFilter, jsonObj, propertyName, jsonObjPath);\n    }\n\n    function parseJSONAttributes(jsonObj) {\n      var attrList = [];\n\n      if (jsonObj instanceof Object) {\n        for (var ait in jsonObj) {\n          if (ait.toString().indexOf(\"__\") == -1 && ait.toString().indexOf(config.attributePrefix) == 0) {\n            attrList.push(ait);\n          }\n        }\n      }\n\n      return attrList;\n    }\n\n    function parseJSONTextAttrs(jsonTxtObj) {\n      var result = \"\";\n\n      if (jsonTxtObj.__cdata != null) {\n        result += \"<![CDATA[\" + jsonTxtObj.__cdata + \"]]>\";\n      }\n\n      if (jsonTxtObj.__text != null) {\n        if (config.escapeMode) result += escapeXmlChars(jsonTxtObj.__text);else result += jsonTxtObj.__text;\n      }\n\n      return result;\n    }\n\n    function parseJSONTextObject(jsonTxtObj) {\n      var result = \"\";\n\n      if (jsonTxtObj instanceof Object) {\n        result += parseJSONTextAttrs(jsonTxtObj);\n      } else if (jsonTxtObj != null) {\n        if (config.escapeMode) result += escapeXmlChars(jsonTxtObj);else result += jsonTxtObj;\n      }\n\n      return result;\n    }\n\n    function getJsonPropertyPath(jsonObjPath, jsonPropName) {\n      if (jsonObjPath === \"\") {\n        return jsonPropName;\n      } else return jsonObjPath + \".\" + jsonPropName;\n    }\n\n    function parseJSONArray(jsonArrRoot, jsonArrObj, attrList, jsonObjPath) {\n      var result = \"\";\n\n      if (jsonArrRoot.length == 0) {\n        result += startTag(jsonArrRoot, jsonArrObj, attrList, true);\n      } else {\n        for (var arIdx = 0; arIdx < jsonArrRoot.length; arIdx++) {\n          result += startTag(jsonArrRoot[arIdx], jsonArrObj, parseJSONAttributes(jsonArrRoot[arIdx]), false);\n          result += parseJSONObject(jsonArrRoot[arIdx], getJsonPropertyPath(jsonObjPath, jsonArrObj));\n          result += endTag(jsonArrRoot[arIdx], jsonArrObj);\n        }\n      }\n\n      return result;\n    }\n\n    function parseJSONObject(jsonObj, jsonObjPath) {\n      var result = \"\";\n      var elementsCnt = jsonXmlElemCount(jsonObj);\n\n      if (elementsCnt > 0) {\n        for (var it in jsonObj) {\n          if (jsonXmlSpecialElem(jsonObj, it) || jsonObjPath != \"\" && !checkJsonObjPropertiesFilter(jsonObj, it, getJsonPropertyPath(jsonObjPath, it))) continue;\n          var subObj = jsonObj[it];\n          var attrList = parseJSONAttributes(subObj);\n\n          if (subObj == null || subObj == undefined) {\n            result += startTag(subObj, it, attrList, true);\n          } else if (subObj instanceof Object) {\n            if (subObj instanceof Array) {\n              result += parseJSONArray(subObj, it, attrList, jsonObjPath);\n            } else if (subObj instanceof Date) {\n              result += startTag(subObj, it, attrList, false);\n              result += subObj.toISOString();\n              result += endTag(subObj, it);\n            } else {\n              var subObjElementsCnt = jsonXmlElemCount(subObj);\n\n              if (subObjElementsCnt > 0 || subObj.__text != null || subObj.__cdata != null) {\n                result += startTag(subObj, it, attrList, false);\n                result += parseJSONObject(subObj, getJsonPropertyPath(jsonObjPath, it));\n                result += endTag(subObj, it);\n              } else {\n                result += startTag(subObj, it, attrList, true);\n              }\n            }\n          } else {\n            result += startTag(subObj, it, attrList, false);\n            result += parseJSONTextObject(subObj);\n            result += endTag(subObj, it);\n          }\n        }\n      }\n\n      result += parseJSONTextObject(jsonObj);\n      return result;\n    }\n\n    this.parseXmlString = function (xmlDocStr) {\n      var isIEParser = window.ActiveXObject || \"ActiveXObject\" in window;\n\n      if (xmlDocStr === undefined) {\n        return null;\n      }\n\n      var xmlDoc;\n\n      if (window.DOMParser) {\n        var parser = new window.DOMParser();\n        var parsererrorNS = null; // IE9+ now is here\n\n        if (!isIEParser) {\n          try {\n            parsererrorNS = parser.parseFromString(\"INVALID\", \"text/xml\").getElementsByTagName(\"parsererror\")[0].namespaceURI;\n          } catch (err) {\n            parsererrorNS = null;\n          }\n        }\n\n        try {\n          xmlDoc = parser.parseFromString(xmlDocStr, \"text/xml\");\n\n          if (parsererrorNS != null && xmlDoc.getElementsByTagNameNS(parsererrorNS, \"parsererror\").length > 0) {\n            //throw new Error('Error parsing XML: '+xmlDocStr);\n            xmlDoc = null;\n          }\n        } catch (err) {\n          xmlDoc = null;\n        }\n      } else {\n        // IE :(\n        if (xmlDocStr.indexOf(\"<?\") == 0) {\n          xmlDocStr = xmlDocStr.substr(xmlDocStr.indexOf(\"?>\") + 2);\n        }\n\n        xmlDoc = new ActiveXObject(\"Microsoft.XMLDOM\");\n        xmlDoc.async = \"false\";\n        xmlDoc.loadXML(xmlDocStr);\n      }\n\n      return xmlDoc;\n    };\n\n    this.asArray = function (prop) {\n      if (prop === undefined || prop == null) return [];else if (prop instanceof Array) return prop;else return [prop];\n    };\n\n    this.toXmlDateTime = function (dt) {\n      if (dt instanceof Date) return dt.toISOString();else if (typeof dt === 'number') return new Date(dt).toISOString();else return null;\n    };\n\n    this.asDateTime = function (prop) {\n      if (typeof prop == \"string\") {\n        return fromXmlDateTime(prop);\n      } else return prop;\n    };\n\n    this.xml2json = function (xmlDoc) {\n      return parseDOMChildren(xmlDoc);\n    };\n\n    this.xml_str2json = function (xmlDocStr) {\n      var xmlDoc = this.parseXmlString(xmlDocStr);\n      if (xmlDoc != null) return this.xml2json(xmlDoc);else return null;\n    };\n\n    this.json2xml_str = function (jsonObj) {\n      return parseJSONObject(jsonObj, \"\");\n    };\n\n    this.json2xml = function (jsonObj) {\n      var xmlDocStr = this.json2xml_str(jsonObj);\n      return this.parseXmlString(xmlDocStr);\n    };\n\n    this.getVersion = function () {\n      return VERSION;\n    };\n  };\n});","map":{"version":3,"sources":["/home/machine/emumba/book-app/app/src/js/xmlToJs.js"],"names":["root","factory","define","amd","exports","module","X2JS","config","VERSION","initConfigDefaults","initRequiredPolyfills","escapeMode","undefined","attributePrefix","arrayAccessForm","emptyNodeForm","enableToStringFunc","arrayAccessFormPaths","skipEmptyTextNodesForObj","stripWhitespaces","datetimeAccessFormPaths","useDoubleQuotes","xmlElementsFilter","jsonPropertiesFilter","keepCData","DOMNodeTypes","ELEMENT_NODE","TEXT_NODE","CDATA_SECTION_NODE","COMMENT_NODE","DOCUMENT_NODE","getNodeLocalName","node","nodeLocalName","localName","baseName","nodeName","getNodePrefix","prefix","escapeXmlChars","str","replace","unescapeXmlChars","checkInStdFiltersArrayForm","stdFiltersArrayForm","obj","name","path","idx","length","filterPath","RegExp","test","toArrayAccessForm","childName","Array","fromXmlDateTime","prop","bits","split","d","Date","secondBits","setHours","setMilliseconds","offsetMinutes","Number","sign","setMinutes","getMinutes","getTimezoneOffset","indexOf","UTC","getFullYear","getMonth","getDate","getHours","getSeconds","getMilliseconds","checkFromXmlDateTimePaths","value","fullPath","checkXmlElementsFilter","childType","childPath","parseDOMChildren","nodeType","result","Object","nodeChildren","childNodes","cidx","child","item","__cnt","aidx","attributes","attr","nodePrefix","__prefix","__text","join","trim","__cdata","toString","nodeValue","startTag","jsonObj","element","attrList","closed","resultStr","attrName","attrVal","substr","endTag","elementName","endsWith","suffix","jsonXmlSpecialElem","jsonObjField","Function","jsonXmlElemCount","elementsCnt","it","checkJsonObjPropertiesFilter","propertyName","jsonObjPath","parseJSONAttributes","ait","push","parseJSONTextAttrs","jsonTxtObj","parseJSONTextObject","getJsonPropertyPath","jsonPropName","parseJSONArray","jsonArrRoot","jsonArrObj","arIdx","parseJSONObject","subObj","toISOString","subObjElementsCnt","parseXmlString","xmlDocStr","isIEParser","window","ActiveXObject","xmlDoc","DOMParser","parser","parsererrorNS","parseFromString","getElementsByTagName","namespaceURI","err","getElementsByTagNameNS","async","loadXML","asArray","toXmlDateTime","dt","asDateTime","xml2json","xml_str2json","json2xml_str","json2xml","getVersion"],"mappings":"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","sourcesContent":["/*\n Copyright 2011-2013 Abdulla Abdurakhmanov\n Original sources are available at https://code.google.com/p/x2js/\n\n Licensed under the Apache License, Version 2.0 (the \"License\");\n you may not use this file except in compliance with the License.\n You may obtain a copy of the License at\n\n http://www.apache.org/licenses/LICENSE-2.0\n\n Unless required by applicable law or agreed to in writing, software\n distributed under the License is distributed on an \"AS IS\" BASIS,\n WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n See the License for the specific language governing permissions and\n limitations under the License.\n */\n\n(function (root, factory) {\n    if (typeof define === \"function\" && define.amd) {\n        define([], factory);\n    } else if (typeof exports === \"object\") {\n        module.exports = factory();\n    } else {\n        root.X2JS = factory();\n    }\n}(this, function () {\n   return function (config) {\n       'use strict';\n           \n       var VERSION = \"1.2.0\";\n       \n       config = config || {};\n       initConfigDefaults();\n       initRequiredPolyfills();\n       \n       function initConfigDefaults() {\n           if(config.escapeMode === undefined) {\n               config.escapeMode = true;\n           }\n           \n           config.attributePrefix = config.attributePrefix || \"_\";\n           config.arrayAccessForm = config.arrayAccessForm || \"none\";\n           config.emptyNodeForm = config.emptyNodeForm || \"text\";\t\t\n           \n           if(config.enableToStringFunc === undefined) {\n               config.enableToStringFunc = true; \n           }\n           config.arrayAccessFormPaths = config.arrayAccessFormPaths || []; \n           if(config.skipEmptyTextNodesForObj === undefined) {\n               config.skipEmptyTextNodesForObj = true;\n           }\n           if(config.stripWhitespaces === undefined) {\n               config.stripWhitespaces = true;\n           }\n           config.datetimeAccessFormPaths = config.datetimeAccessFormPaths || [];\n   \n           if(config.useDoubleQuotes === undefined) {\n               config.useDoubleQuotes = false;\n           }\n           \n           config.xmlElementsFilter = config.xmlElementsFilter || [];\n           config.jsonPropertiesFilter = config.jsonPropertiesFilter || [];\n           \n           if(config.keepCData === undefined) {\n               config.keepCData = false;\n           }\n       }\n   \n       var DOMNodeTypes = {\n           ELEMENT_NODE \t   : 1,\n           TEXT_NODE    \t   : 3,\n           CDATA_SECTION_NODE : 4,\n           COMMENT_NODE\t   : 8,\n           DOCUMENT_NODE \t   : 9\n       };\n       \n       function initRequiredPolyfills() {\t\t\n       }\n       \n       function getNodeLocalName( node ) {\n           var nodeLocalName = node.localName;\t\t\t\n           if(nodeLocalName == null) // Yeah, this is IE!! \n               nodeLocalName = node.baseName;\n           if(nodeLocalName == null || nodeLocalName==\"\") // ==\"\" is IE too\n               nodeLocalName = node.nodeName;\n           return nodeLocalName;\n       }\n       \n       function getNodePrefix(node) {\n           return node.prefix;\n       }\n           \n       function escapeXmlChars(str) {\n           if(typeof(str) == \"string\")\n               return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;').replace(/'/g, '&apos;');\n           else\n               return str;\n       }\n   \n       function unescapeXmlChars(str) {\n           return str.replace(/&lt;/g, '<').replace(/&gt;/g, '>').replace(/&quot;/g, '\"').replace(/&apos;/g, \"'\").replace(/&amp;/g, '&');\n       }\n       \n       function checkInStdFiltersArrayForm(stdFiltersArrayForm, obj, name, path) {\n           var idx = 0;\n           for(; idx < stdFiltersArrayForm.length; idx++) {\n               var filterPath = stdFiltersArrayForm[idx];\n               if( typeof filterPath === \"string\" ) {\n                   if(filterPath == path)\n                       break;\n               }\n               else\n               if( filterPath instanceof RegExp) {\n                   if(filterPath.test(path))\n                       break;\n               }\t\t\t\t\n               else\n               if( typeof filterPath === \"function\") {\n                   if(filterPath(obj, name, path))\n                       break;\n               }\n           }\n           return idx!=stdFiltersArrayForm.length;\n       }\n       \n       function toArrayAccessForm(obj, childName, path) {\n           switch(config.arrayAccessForm) {\n               case \"property\":\n                   if(!(obj[childName] instanceof Array))\n                       obj[childName+\"_asArray\"] = [obj[childName]];\n                   else\n                       obj[childName+\"_asArray\"] = obj[childName];\n                   break;\n               /*case \"none\":\n                   break;*/\n           }\n           \n           if(!(obj[childName] instanceof Array) && config.arrayAccessFormPaths.length > 0) {\n               if(checkInStdFiltersArrayForm(config.arrayAccessFormPaths, obj, childName, path)) {\n                   obj[childName] = [obj[childName]];\n               }\t\t\t\n           }\n       }\n       \n       function fromXmlDateTime(prop) {\n           // Implementation based up on http://stackoverflow.com/questions/8178598/xml-datetime-to-javascript-date-object\n           // Improved to support full spec and optional parts\n           var bits = prop.split(/[-T:+Z]/g);\n           \n           var d = new Date(bits[0], bits[1]-1, bits[2]);\t\t\t\n           var secondBits = bits[5].split(\"\\.\");\n           d.setHours(bits[3], bits[4], secondBits[0]);\n           if(secondBits.length>1)\n               d.setMilliseconds(secondBits[1]);\n   \n           // Get supplied time zone offset in minutes\n           if(bits[6] && bits[7]) {\n               var offsetMinutes = bits[6] * 60 + Number(bits[7]);\n               var sign = /\\d\\d-\\d\\d:\\d\\d$/.test(prop)? '-' : '+';\n   \n               // Apply the sign\n               offsetMinutes = 0 + (sign == '-'? -1 * offsetMinutes : offsetMinutes);\n   \n               // Apply offset and local timezone\n               d.setMinutes(d.getMinutes() - offsetMinutes - d.getTimezoneOffset())\n           }\n           else\n               if(prop.indexOf(\"Z\", prop.length - 1) !== -1) {\n                   d = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate(), d.getHours(), d.getMinutes(), d.getSeconds(), d.getMilliseconds()));\t\t\t\t\t\n               }\n   \n           // d is now a local time equivalent to the supplied time\n           return d;\n       }\n       \n       function checkFromXmlDateTimePaths(value, childName, fullPath) {\n           if(config.datetimeAccessFormPaths.length > 0) {\n               var path = fullPath.split(\"\\.#\")[0];\n               if(checkInStdFiltersArrayForm(config.datetimeAccessFormPaths, value, childName, path)) {\n                   return fromXmlDateTime(value);\n               }\n               else\n                   return value;\t\t\t\n           }\n           else\n               return value;\n       }\n       \n       function checkXmlElementsFilter(obj, childType, childName, childPath) {\n           if( childType == DOMNodeTypes.ELEMENT_NODE && config.xmlElementsFilter.length > 0) {\n               return checkInStdFiltersArrayForm(config.xmlElementsFilter, obj, childName, childPath);\t\n           }\n           else\n               return true;\n       }\t\n   \n       function parseDOMChildren( node, path ) {\n           if(node.nodeType == DOMNodeTypes.DOCUMENT_NODE) {\n               var result = new Object;\n               var nodeChildren = node.childNodes;\n               // Alternative for firstElementChild which is not supported in some environments\n               for(var cidx=0; cidx <nodeChildren.length; cidx++) {\n                   var child = nodeChildren.item(cidx);\n                   if(child.nodeType == DOMNodeTypes.ELEMENT_NODE) {\n                       var childName = getNodeLocalName(child);\n                       result[childName] = parseDOMChildren(child, childName);\n                   }\n               }\n               return result;\n           }\n           else\n           if(node.nodeType == DOMNodeTypes.ELEMENT_NODE) {\n               var result = new Object;\n               result.__cnt=0;\n               \n               var nodeChildren = node.childNodes;\n               \n               // Children nodes\n               for(var cidx=0; cidx <nodeChildren.length; cidx++) {\n                   var child = nodeChildren.item(cidx); // nodeChildren[cidx];\n                   var childName = getNodeLocalName(child);\n                   \n                   if(child.nodeType!= DOMNodeTypes.COMMENT_NODE) {\n                       var childPath = path+\".\"+childName;\n                       if (checkXmlElementsFilter(result,child.nodeType,childName,childPath)) {\n                           result.__cnt++;\n                           if(result[childName] == null) {\n                               result[childName] = parseDOMChildren(child, childPath);\n                               toArrayAccessForm(result, childName, childPath);\t\t\t\t\t\n                           }\n                           else {\n                               if(result[childName] != null) {\n                                   if( !(result[childName] instanceof Array)) {\n                                       result[childName] = [result[childName]];\n                                       toArrayAccessForm(result, childName, childPath);\n                                   }\n                               }\n                               (result[childName])[result[childName].length] = parseDOMChildren(child, childPath);\n                           }\n                       }\n                   }\t\t\t\t\t\t\t\t\n               }\n               \n               // Attributes\n               for(var aidx=0; aidx <node.attributes.length; aidx++) {\n                   var attr = node.attributes.item(aidx); // [aidx];\n                   result.__cnt++;\n                   result[config.attributePrefix+attr.name]=attr.value;\n               }\n               \n               // Node namespace prefix\n               var nodePrefix = getNodePrefix(node);\n               if(nodePrefix!=null && nodePrefix!=\"\") {\n                   result.__cnt++;\n                   result.__prefix=nodePrefix;\n               }\n               \n               if(result[\"#text\"]!=null) {\t\t\t\t\n                   result.__text = result[\"#text\"];\n                   if(result.__text instanceof Array) {\n                       result.__text = result.__text.join(\"\\n\");\n                   }\n                   //if(config.escapeMode)\n                   //\tresult.__text = unescapeXmlChars(result.__text);\n                   if(config.stripWhitespaces)\n                       result.__text = result.__text.trim();\n                   delete result[\"#text\"];\n                   if(config.arrayAccessForm==\"property\")\n                       delete result[\"#text_asArray\"];\n                   result.__text = checkFromXmlDateTimePaths(result.__text, childName, path+\".\"+childName);\n               }\n               if(result[\"#cdata-section\"]!=null) {\n                   result.__cdata = result[\"#cdata-section\"];\n                   delete result[\"#cdata-section\"];\n                   if(config.arrayAccessForm==\"property\")\n                       delete result[\"#cdata-section_asArray\"];\n               }\n               \n               if( result.__cnt == 0 && config.emptyNodeForm==\"text\" ) {\n                   result = '';\n               }\n               else\n               if( result.__cnt == 1 && result.__text!=null  ) {\n                   result = result.__text;\n               }\n               else\n               if( result.__cnt == 1 && result.__cdata!=null && !config.keepCData  ) {\n                   result = result.__cdata;\n               }\t\t\t\n               else\t\t\t\n               if ( result.__cnt > 1 && result.__text!=null && config.skipEmptyTextNodesForObj) {\n                   if( (config.stripWhitespaces && result.__text==\"\") || (result.__text.trim()==\"\")) {\n                       delete result.__text;\n                   }\n               }\n               delete result.__cnt;\t\t\t\n               \n               if( config.enableToStringFunc && (result.__text!=null || result.__cdata!=null )) {\n                   result.toString = function() {\n                       return (this.__text!=null? this.__text:'')+( this.__cdata!=null ? this.__cdata:'');\n                   };\n               }\n               \n               return result;\n           }\n           else\n           if(node.nodeType == DOMNodeTypes.TEXT_NODE || node.nodeType == DOMNodeTypes.CDATA_SECTION_NODE) {\n               return node.nodeValue;\n           }\t\n       }\n       \n       function startTag(jsonObj, element, attrList, closed) {\n           var resultStr = \"<\"+ ( (jsonObj!=null && jsonObj.__prefix!=null)? (jsonObj.__prefix+\":\"):\"\") + element;\n           if(attrList!=null) {\n               for(var aidx = 0; aidx < attrList.length; aidx++) {\n                   var attrName = attrList[aidx];\n                   var attrVal = jsonObj[attrName];\n                   if(config.escapeMode)\n                       attrVal=escapeXmlChars(attrVal);\n                   resultStr+=\" \"+attrName.substr(config.attributePrefix.length)+\"=\";\n                   if(config.useDoubleQuotes)\n                       resultStr+='\"'+attrVal+'\"';\n                   else\n                       resultStr+=\"'\"+attrVal+\"'\";\n               }\n           }\n           if(!closed)\n               resultStr+=\">\";\n           else\n               resultStr+=\"/>\";\n           return resultStr;\n       }\n       \n       function endTag(jsonObj,elementName) {\n           return \"</\"+ (jsonObj.__prefix!=null? (jsonObj.__prefix+\":\"):\"\")+elementName+\">\";\n       }\n       \n       function endsWith(str, suffix) {\n           return str.indexOf(suffix, str.length - suffix.length) !== -1;\n       }\n       \n       function jsonXmlSpecialElem ( jsonObj, jsonObjField ) {\n           if((config.arrayAccessForm==\"property\" && endsWith(jsonObjField.toString(),(\"_asArray\"))) \n                   || jsonObjField.toString().indexOf(config.attributePrefix)==0 \n                   || jsonObjField.toString().indexOf(\"__\")==0\n                   || (jsonObj[jsonObjField] instanceof Function) )\n               return true;\n           else\n               return false;\n       }\n       \n       function jsonXmlElemCount ( jsonObj ) {\n           var elementsCnt = 0;\n           if(jsonObj instanceof Object ) {\n               for( var it in jsonObj  ) {\n                   if(jsonXmlSpecialElem ( jsonObj, it) )\n                       continue;\t\t\t\n                   elementsCnt++;\n               }\n           }\n           return elementsCnt;\n       }\n       \n       function checkJsonObjPropertiesFilter(jsonObj, propertyName, jsonObjPath) {\n           return config.jsonPropertiesFilter.length == 0\n               || jsonObjPath==\"\"\n               || checkInStdFiltersArrayForm(config.jsonPropertiesFilter, jsonObj, propertyName, jsonObjPath);\t\n       }\n       \n       function parseJSONAttributes ( jsonObj ) {\n           var attrList = [];\n           if(jsonObj instanceof Object ) {\n               for( var ait in jsonObj  ) {\n                   if(ait.toString().indexOf(\"__\")== -1 && ait.toString().indexOf(config.attributePrefix)==0) {\n                       attrList.push(ait);\n                   }\n               }\n           }\n           return attrList;\n       }\n       \n       function parseJSONTextAttrs ( jsonTxtObj ) {\n           var result =\"\";\n           \n           if(jsonTxtObj.__cdata!=null) {\t\t\t\t\t\t\t\t\t\t\n               result+=\"<![CDATA[\"+jsonTxtObj.__cdata+\"]]>\";\t\t\t\t\t\n           }\n           \n           if(jsonTxtObj.__text!=null) {\t\t\t\n               if(config.escapeMode)\n                   result+=escapeXmlChars(jsonTxtObj.__text);\n               else\n                   result+=jsonTxtObj.__text;\n           }\n           return result;\n       }\n       \n       function parseJSONTextObject ( jsonTxtObj ) {\n           var result =\"\";\n   \n           if( jsonTxtObj instanceof Object ) {\n               result+=parseJSONTextAttrs ( jsonTxtObj );\n           }\n           else\n               if(jsonTxtObj!=null) {\n                   if(config.escapeMode)\n                       result+=escapeXmlChars(jsonTxtObj);\n                   else\n                       result+=jsonTxtObj;\n               }\n           \n           return result;\n       }\n       \n       function getJsonPropertyPath(jsonObjPath, jsonPropName) {\n           if (jsonObjPath===\"\") {\n               return jsonPropName;\n           }\n           else\n               return jsonObjPath+\".\"+jsonPropName;\n       }\n       \n       function parseJSONArray ( jsonArrRoot, jsonArrObj, attrList, jsonObjPath ) {\n           var result = \"\"; \n           if(jsonArrRoot.length == 0) {\n               result+=startTag(jsonArrRoot, jsonArrObj, attrList, true);\n           }\n           else {\n               for(var arIdx = 0; arIdx < jsonArrRoot.length; arIdx++) {\n                   result+=startTag(jsonArrRoot[arIdx], jsonArrObj, parseJSONAttributes(jsonArrRoot[arIdx]), false);\n                   result+=parseJSONObject(jsonArrRoot[arIdx], getJsonPropertyPath(jsonObjPath,jsonArrObj));\n                   result+=endTag(jsonArrRoot[arIdx],jsonArrObj);\n               }\n           }\n           return result;\n       }\n       \n       function parseJSONObject ( jsonObj, jsonObjPath ) {\n           var result = \"\";\t\n   \n           var elementsCnt = jsonXmlElemCount ( jsonObj );\n           \n           if(elementsCnt > 0) {\n               for( var it in jsonObj ) {\n                   \n                   if(jsonXmlSpecialElem ( jsonObj, it) || (jsonObjPath!=\"\" && !checkJsonObjPropertiesFilter(jsonObj, it, getJsonPropertyPath(jsonObjPath,it))) )\n                       continue;\t\t\t\n                   \n                   var subObj = jsonObj[it];\t\t\t\t\t\t\n                   \n                   var attrList = parseJSONAttributes( subObj )\n                   \n                   if(subObj == null || subObj == undefined) {\n                       result+=startTag(subObj, it, attrList, true);\n                   }\n                   else\n                   if(subObj instanceof Object) {\n                       \n                       if(subObj instanceof Array) {\t\t\t\t\t\n                           result+=parseJSONArray( subObj, it, attrList, jsonObjPath );\t\t\t\t\t\n                       }\n                       else if(subObj instanceof Date) {\n                           result+=startTag(subObj, it, attrList, false);\n                           result+=subObj.toISOString();\n                           result+=endTag(subObj,it);\n                       }\n                       else {\n                           var subObjElementsCnt = jsonXmlElemCount ( subObj );\n                           if(subObjElementsCnt > 0 || subObj.__text!=null || subObj.__cdata!=null) {\n                               result+=startTag(subObj, it, attrList, false);\n                               result+=parseJSONObject(subObj, getJsonPropertyPath(jsonObjPath,it));\n                               result+=endTag(subObj,it);\n                           }\n                           else {\n                               result+=startTag(subObj, it, attrList, true);\n                           }\n                       }\n                   }\n                   else {\n                       result+=startTag(subObj, it, attrList, false);\n                       result+=parseJSONTextObject(subObj);\n                       result+=endTag(subObj,it);\n                   }\n               }\n           }\n           result+=parseJSONTextObject(jsonObj);\n           \n           return result;\n       }\n       \n       this.parseXmlString = function(xmlDocStr) {\n           var isIEParser = window.ActiveXObject || \"ActiveXObject\" in window;\n           if (xmlDocStr === undefined) {\n               return null;\n           }\n           var xmlDoc;\n           if (window.DOMParser) {\n               var parser=new window.DOMParser();\t\t\t\n               var parsererrorNS = null;\n               // IE9+ now is here\n               if(!isIEParser) {\n                   try {\n                       parsererrorNS = parser.parseFromString(\"INVALID\", \"text/xml\").getElementsByTagName(\"parsererror\")[0].namespaceURI;\n                   }\n                   catch(err) {\t\t\t\t\t\n                       parsererrorNS = null;\n                   }\n               }\n               try {\n                   xmlDoc = parser.parseFromString( xmlDocStr, \"text/xml\" );\n                   if( parsererrorNS!= null && xmlDoc.getElementsByTagNameNS(parsererrorNS, \"parsererror\").length > 0) {\n                       //throw new Error('Error parsing XML: '+xmlDocStr);\n                       xmlDoc = null;\n                   }\n               }\n               catch(err) {\n                   xmlDoc = null;\n               }\n           }\n           else {\n               // IE :(\n               if(xmlDocStr.indexOf(\"<?\")==0) {\n                   xmlDocStr = xmlDocStr.substr( xmlDocStr.indexOf(\"?>\") + 2 );\n               }\n               xmlDoc=new ActiveXObject(\"Microsoft.XMLDOM\");\n               xmlDoc.async=\"false\";\n               xmlDoc.loadXML(xmlDocStr);\n           }\n           return xmlDoc;\n       };\n       \n       this.asArray = function(prop) {\n           if (prop === undefined || prop == null)\n               return [];\n           else\n           if(prop instanceof Array)\n               return prop;\n           else\n               return [prop];\n       };\n       \n       this.toXmlDateTime = function(dt) {\n           if(dt instanceof Date)\n               return dt.toISOString();\n           else\n           if(typeof(dt) === 'number' )\n               return new Date(dt).toISOString();\n           else\t\n               return null;\n       };\n       \n       this.asDateTime = function(prop) {\n           if(typeof(prop) == \"string\") {\n               return fromXmlDateTime(prop);\n           }\n           else\n               return prop;\n       };\n   \n       this.xml2json = function (xmlDoc) {\n           return parseDOMChildren ( xmlDoc );\n       };\n       \n       this.xml_str2json = function (xmlDocStr) {\n           var xmlDoc = this.parseXmlString(xmlDocStr);\n           if(xmlDoc!=null)\n               return this.xml2json(xmlDoc);\n           else\n               return null;\n       };\n   \n       this.json2xml_str = function (jsonObj) {\n           return parseJSONObject ( jsonObj, \"\" );\n       };\n   \n       this.json2xml = function (jsonObj) {\n           var xmlDocStr = this.json2xml_str (jsonObj);\n           return this.parseXmlString(xmlDocStr);\n       };\n       \n       this.getVersion = function () {\n           return VERSION;\n       };\t\n   }\n}))"]},"metadata":{},"sourceType":"module"}